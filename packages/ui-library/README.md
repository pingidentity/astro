UI library
==========
A library made of reusable React components, util functions and static assets
(e.g. CSS).



Prerequisites
-------------
* node v0.10.35: https://nodejs.org/en/download/releases/
* Fix the npm permissions, as described here under Option 1:
https://docs.npmjs.com/getting-started/fixing-npm-permissions
* npm v2.7.0: `$ npm install -g npm@2.7.0`
* eslint v1.6.0 (only if you have eslint installed globally):
`$ npm install -g eslint@1.6.0`
* jest-cli v0.4.19 (only if you have jest-cli installed globally):
`$ npm install -g jest-cli@0.4.19`

To verify if a package is installed globally, run:
`$ npm list -g package-name`



Resources
---------
See this Confluence page
(https://docs.corp.pingidentity.com/display/ID/UI+library) for details on
various topics:
* how to contribute to the library
* how to integrate the library into other npm based projects
* how to build/release the library



Running the library
-------------------
Run
`npm install && npm run start`
and open http://localhost:8080/index.html in the browser.



Verifying the local changes
---------------------------
`npm run verify`
runs the linting and the testing using the global node/npm installation.

`npm run coverage`
in addition to `npm run verify` above, this will generate the code coverage report
(in coverage/lcov-report/index.html).

`make verify`
runs the build (just like on the build machine); it downloads node and npm
locally, installs the required node modules, and runs the linting and testing.



Building the UI library
-----------------------
The library can be built for distribution as a node module with `make package`.
The JS documentation is generated using `npm run doc`.
The library can be built as a bundle of static resources to be deployed in a
web server with `npm run pack`.
See the *scripts* section in package.json for more options.



Hosting the UI library
----------------------
All UI library versions starting with 1.2.0-SNAPSHOT are hosted at
http://uilibrary.ping-eng.com/. Each "UI Library Build" build in Jenkins uploads
the latest version to the hosting server and adds it to the versions json file.
This is done through the *package-and-upload-for-hosting* make recipe.

The files needed on the hosting server in */var/www/html* are as follows:
* landing.js (in source control in */ui-library/hosting* - generated by webpack bundling locally then manually uploaded)
* index.html (in source control in */ui-library/hosting* - generated by webpack bundling locally then manually uploaded)
* versions.json (modified dynamically by the upload script every time a new
version is uploaded; it started as an empty json file (ie. []))
* the UI library packages (as generated by webpack).

Example:
* /var/www/html/index.html
* /var/www/html/versions.json
* /var/www/html/1.2.0-SNAPSHOT/
  * build-doc
  * landing.css
  * landing.css.map
  * landing.js
  * landing.js.map
  * etc

The hosted landing page can be tested locally by running the `npm run webpack-start-landing` script.
Note, that the landing app will start on port 8082.

To update the landing page, update the landing app under */ui-library/hosting* and test locally using the
`npm run webpack-start-landing` script to open the dev server. Once it works locally and is approved then run the
`npm run pack-landing` script to bundle the app and generate the static assets. Then, upload the static assets to
the hosting server via ssh/scp commands.
Note, you may need to modify the permissions on the ssh key file to allow read permissions:
> chmod 400 FARM-33-341f336d.us-west-2.pem

Example:
> ssh -i ./hosting/FARM-33-341f336d.us-west-2.pem ubuntu@35.162.25.94

> scp -i ./hosting/FARM-33-341f336d.us-west-2.pem <src> ubuntu@35.162.25.94:<dest>


References
----------
* http://learnjs.io/blog/2014/01/20/rework-npm-myth-clean-css/
* https://www.npmjs.com/package/npm-css

* https://github.com/petehunt/webpack-howto
* https://github.com/shanewilson/react-webpack-example
* http://simonsmith.io/using-webpack-to-build-react-components-and-their-assets/
* http://christianalfoni.github.io/javascript/2014/12/13/did-you-know-webpack-and-react-is-awesome.html

* http://blog.siftscience.com/blog/2015/best-practices-for-building-large-react-applications

* https://docs.npmjs.com/misc/scripts
* http://krasimirtsonev.com/blog/article/Fun-playing-with-npm-dependencies-and-postinstall-script

