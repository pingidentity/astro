UI library
==========

A library made of reusable React components, util functions and static assets
(e.g. CSS).

## Development

This is what you need to get started building.

### Dependencies

* [Node.js](https://nodejs.org/en/download/releases/) v8.12.0
* Fix the npm permissions, as described [here](https://docs.npmjs.com/getting-started/fixing-npm-permissions), under Option 1
* ESLint v5.15.3 (only if you have ESLint installed globally): `$ npm install -g eslint@5.15.3`
* Jest CLI v24.5.0 (only if you have Jest CLI installed globally): `$ npm install -g jest-cli@24.5.0`

### Running

Run `npm install && npm run start` and open http://localhost:8080
in the browser.

## Distribution

Testing, building, and hosting locally.

### Verify local changes

`npm run verify`
Runs the linting and the testing using the global node/npm installation.

`npm run coverage`
In addition to `npm run verify` above, this will generate the code coverage report
(in coverage/lcov-report/index.html).

`make verify`
Runs the build (just like on the build machine); it downloads node and npm
locally, installs the required node modules, and runs the linting and testing.

### Testing locally with Docker

To test locally with Docker, first [installl Docker](https://www.docker.com/get-started) on your machine.

Next, run:

```
npm run test-w-docker -- --spec=testSuiteName
```

_Note: Using the `--spec` flag only runs the specified tests - not all of them._

The additional `--`'s are NPM's arg passthrough syntax.

### Building

The library can be built for distribution as a node module with `make package`.

The JS documentation is generated using `npm run doc`.

The library can be built as a bundle of static resources to be deployed in a
web server with `npm run pack`.

See the `scripts` section in *package.json* for more options.

### Hosting the UI library

All UI library versions starting with 1.2.0-SNAPSHOT are hosted at
http://uilibrary.ping-eng.com/. Each "UI Library Build" build in Jenkins uploads
the latest version to the hosting server and adds it to the versions json file.
This is done through the *package-and-upload-for-hosting* make recipe.

The files needed on the hosting server in */var/www/html* are as follows:
* `landing.js` (in source control in */ui-library/hosting/* and compiled to
    */ui-library/build-landing/* after budling the scripts)
    - Generated by webpack bundling locally then manually uploaded
* `index.html` (in source control in */ui-library/hosting/* and compiled to
    */ui-library/build-landing/* after budling the scripts)
    - Generated by webpack bundling locally then manually uploaded
* `versions.json` (modified dynamically by the upload script every time a new version is uploaded; it started as an empty json file (ie. `[]`))
* The UI library packages (as generated by webpack)

Example:
```
/var/www/html/index.html
/var/www/html/versions.json
/var/www/html/landing.css
/var/www/html/landing.css.map
/var/www/html/landing.js
/var/www/html/landing.js.map
```

The hosted landing page can be tested locally by running the `npm run webpack-start-landing` script.
Note, that the landing app will start on port 8082.

To update the landing page, update the landing app under */ui-library/hosting* and test locally using the
`npm run webpack-start-landing` script to open the dev server. Once it works locally and is approved then run the
`npm run pack-landing` script to bundle the app and generate the static assets.
The assets are compiled to */ui-library/build-landing/*
Then, upload the static assets to
the hosting server via ssh/scp commands or connect to the server using
SFTP and the below certificate with a program like Cyberduck.

Note, you may need to modify the permissions on the ssh key file to allow read permissions:
```
chmod 400 FARM-33-341f336d.us-west-2.pem
```

Example:
```
ssh -i ./hosting/FARM-33-341f336d.us-west-2.pem ubuntu@35.165.241.78

scp -i ./hosting/FARM-33-341f336d.us-west-2.pem <SRC> ubuntu@35.165.241.78:<DEST>
```

## Resources

See [this](https://docs.corp.pingidentity.com/display/ID/UI+library) Confluence page
for details on various topics, such as:
* How to contribute to the library
* How to integrate the library into other npm based projects
* How to build/release the library

## Licenses

The Library icons for Facebook, Twitter and LinkedIn are provided by Font Awesome. Their usage is governed
by the Font Awesome Pro License (https://fontawesome.com/license).